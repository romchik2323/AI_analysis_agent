#  AI Analysis Agent

**Python ‚Ä¢ LLM ‚Ä¢ MCP ‚Ä¢ RAG ‚Ä¢ FastAPI ‚Ä¢ Machine Learning**

–ê–≥–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ –æ—Ç—Ç–æ–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Claude API, –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Qwen2.5 –∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º –ø–æ–∏—Å–∫–æ–º –Ω–∞ E5-large. –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π ML-–ø–∞–π–ø–ª–∞–π–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º —Ç–∞–±–ª–∏—á–Ω—ã–º –¥–∞—Ç–∞—Å–µ—Ç–æ–º.

[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://www.python.org/downloads/)


---

##  –ó–∞–¥–∞—á–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ö–æ–º–ø–∞–Ω–∏–∏ —Ç–µ—Ä—è—é—Ç 20-30% –∫–ª–∏–µ–Ω—Ç–æ–≤ –µ–∂–µ–≥–æ–¥–Ω–æ. –ß—Ç–æ–±—ã —É–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤, –Ω—É–∂–Ω–æ:

1. **–ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –æ—Ç—Ç–æ–∫** –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç —É–π–¥—ë—Ç
2. **–ü–æ–Ω—è—Ç—å –ø—Ä–∏—á–∏–Ω—ã** ‚Äî –∫–∞–∫–∏–µ —Ñ–∞–∫—Ç–æ—Ä—ã –≤–ª–∏—è—é—Ç –Ω–∞ —Ä–µ—à–µ–Ω–∏–µ —É–π—Ç–∏
3. **–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é** ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
4. **–û–±—ä—è—Å–Ω–∏—Ç—å –º–æ–¥–µ–ª—å** ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ü–∏—Ñ—Ä—ã, –∞ –ø–æ–Ω—è—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ—à–∞–µ—Ç –≤—Å–µ 4 –∑–∞–¥–∞—á–∏, —Ä–∞–±–æ—Ç–∞—è –∫–∞–∫ **AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç** –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤ –∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤.

---
##  –ß—Ç–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ

### Machine Learning
- Feature engineering –¥–ª—è —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤ (`class_weight='balanced'`)
- Feature importance –∞–Ω–∞–ª–∏–∑
- Cross-validation –∏ –º–µ—Ç—Ä–∏–∫–∏ (ROC-AUC, Precision/Recall)

### LLM & NLP
- –†–∞–±–æ—Ç–∞ —Å Anthropic API (—Ñ—É–Ω–∫—Ü–∏–∏, streaming)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π —á–µ—Ä–µ–∑ Ollama
- Prompt engineering –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á
- Context window management (–æ–±—Ä–µ–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏)

### RAG (Retrieval-Augmented Generation)
- Sentence embeddings (E5-large, 1024-dim)
- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (cosine similarity)
- –ü—Ä–µ—Ñ–∏–∫—Å—ã –¥–ª—è E5 (`query:` vs `passage:`)
- –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (semantic + metadata filters)

### Backend Development
- FastAPI –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- Pydantic —Å—Ö–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- REST API design (CRUD + –ø–æ–∏—Å–∫)
- Background tasks –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### MCP (Model Context Protocol)
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è MCP —Å–µ—Ä–≤–µ—Ä–∞
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (tools)
- stdio —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Claude Desktop / Cursor

### Software Engineering
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º)
- Dependency injection (–ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã LLM)
- Error handling –∏ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
- –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π (pickle)
- Type hints –∏ dataclasses

##  –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              MCP Server / FastAPI Backend               ‚îÇ
‚îÇ        (Claude Desktop, Cursor, REST API clients)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ                          ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ    LLM Agent        ‚îÇ   ‚îÇ   Universal Churn     ‚îÇ
    ‚îÇ                     ‚îÇ   ‚îÇ      Analyzer         ‚îÇ
    ‚îÇ  ‚Ä¢ Claude API       ‚îÇ   ‚îÇ                       ‚îÇ
    ‚îÇ  ‚Ä¢ Qwen2.5 (Ollama) ‚îÇ   ‚îÇ  ‚Ä¢ Random Forest      ‚îÇ
    ‚îÇ  ‚Ä¢ Auto provider    ‚îÇ   ‚îÇ  ‚Ä¢ Gradient Boosting  ‚îÇ
    ‚îÇ                     ‚îÇ   ‚îÇ  ‚Ä¢ Auto preprocessing ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ                          ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ              RAG Engine                         ‚îÇ
    ‚îÇ  ‚Ä¢ E5-large embeddings (1024-dim)               ‚îÇ
    ‚îÇ  ‚Ä¢ Vector store (numpy/pickle)                  ‚îÇ
    ‚îÇ  ‚Ä¢ 10+ domain knowledge rules                   ‚îÇ
    ‚îÇ  ‚Ä¢ Historical analysis storage                  ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ø–æ–ª–Ω–∞—è –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å ‚Äî –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –∏ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.

---

##  –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1Ô∏è‚É£ Universal ML Pipeline

```python
from churn_analyzer import UniversalChurnAnalyzer

# –†–∞–±–æ—Ç–∞–µ—Ç —Å –õ–Æ–ë–´–ú CSV ‚Äî –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
analyzer = UniversalChurnAnalyzer()
analyzer.load_data("any_dataset.csv")  # –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Ö–æ–¥–∏—Ç —Ü–µ–ª–µ–≤—É—é –∫–æ–ª–æ–Ω–∫—É
report = analyzer.train()  # –æ–±—É—á–∞–µ—Ç –º–æ–¥–µ–ª—å –∑–∞ 1 –≤—ã–∑–æ–≤

print(f"ROC-AUC: {report.roc_auc}")
print(f"Top risk factor: {report.top_factors[0]['feature']}")
```

**–ò–Ω–¥—É—Å—Ç—Ä–∏–∏:**
-  –¢–µ–ª–µ–∫–æ–º (–æ—Ç—Ç–æ–∫ –∞–±–æ–Ω–µ–Ω—Ç–æ–≤)
-  –ë–∞–Ω–∫–∏ (–∑–∞–∫—Ä—ã—Ç–∏–µ —Å—á–µ—Ç–æ–≤)
-  SaaS (–æ—Ç–º–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–æ–∫)
-  E-commerce (–ø–æ—Ç–µ—Ä—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π)
-  –°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ (–æ—Ç–∫–∞–∑ –æ—Ç –ø–æ–ª–∏—Å–∞)

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ ‚Üí LabelEncoder
- –ü—Ä–æ–ø—É—Å–∫–∏ ‚Üí –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –º–µ–¥–∏–∞–Ω–æ–π/Unknown
- ID-–∫–æ–ª–æ–Ω–∫–∏ ‚Üí –∞–≤—Ç–æ—É–¥–∞–ª–µ–Ω–∏–µ
- –¶–µ–ª–µ–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è ‚Üí –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è (Yes/No ‚Üí 1/0)

---

### 2Ô∏è‚É£ LLM Agent —Å RAG

```python
from agent import ChurnAgent

# –ê–≤—Ç–æ–≤—ã–±–æ—Ä: Claude API ‚Üí Ollama ‚Üí CPU-only mode
agent = ChurnAgent(provider="auto")

# –ê–Ω–∞–ª–∏–∑ –æ—Ç—á—ë—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
analysis = agent.analyze_report(report)
print(analysis)
# ‚Üí "–û—Å–Ω–æ–≤–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –æ—Ç—Ç–æ–∫–∞ ‚Äî –ø–æ–º–µ—Å—è—á–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã (42.7% vs 2.8% –¥–ª—è 
#    –¥–≤—É—Ö–ª–µ—Ç–Ω–∏—Ö). –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º –Ω–∞ 
#    –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã —Å–æ —Å–∫–∏–¥–∫–æ–π 15%..."

# –î–∏–∞–ª–æ–≥
response = agent.chat("–ü–æ—á–µ–º—É –∫–ª–∏–µ–Ω—Ç—ã —Å Fiber optic —É—Ö–æ–¥—è—Ç —á–∞—â–µ?")
# ‚Üí –°–∏—Å—Ç–µ–º–∞ –∏—â–µ—Ç –≤ RAG –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π, –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ–∞–∫—Ç—ã, 
#    –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —Å —É—á—ë—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

# –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
customer = {"tenure": 2, "Contract": "Month-to-month", "MonthlyCharges": 85}
explanation = agent.explain_customer(customer, churn_prob=67.3)
# ‚Üí "–≠—Ç–æ—Ç –∫–ª–∏–µ–Ω—Ç –≤ –≥—Ä—É–ø–ø–µ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞ –∏–∑-–∑–∞ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ —Å—Ä–æ–∫–∞ (2 –º–µ—Å—è—Ü–∞) 
#    –∏ –ø–æ–º–µ—Å—è—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å upgrade –Ω–∞..."
```

**LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**
- ‚úÖ **Claude API** (Anthropic) ‚Äî –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∞–Ω–∞–ª–∏–∑–∞
- ‚úÖ **Qwen2.5** (Ollama) ‚Äî –ø–æ–ª–Ω—ã–π offline —Ä–µ–∂–∏–º, –±–µ—Å–ø–ª–∞—Ç–Ω–æ
- ‚úÖ **Auto mode** ‚Äî –∞–≤—Ç–æ–≤—ã–±–æ—Ä –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞

---

### 3Ô∏è‚É£ RAG Engine –Ω–∞ E5-large

```python
from rag_engine import ChurnRAGEngine

rag = ChurnRAGEngine()
rag.initialize()

# –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
results = rag.search("–ø–æ—á–µ–º—É –ø–æ–º–µ—Å—è—á–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –æ–ø–∞—Å–Ω—ã –¥–ª—è –±–∏–∑–Ω–µ—Å–∞")
# ‚Üí [
#     {"text": "–ö–ª–∏–µ–Ω—Ç—ã —Å –ø–æ–º–µ—Å—è—á–Ω—ã–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ —É—Ö–æ–¥—è—Ç –≤ 3-4 —Ä–∞–∑–∞ —á–∞—â–µ...",
#      "score": 0.89},
#     {"text": "–°—Ç—Ä–∞—Ç–µ–≥–∏—è —É–¥–µ—Ä–∂–∞–Ω–∏—è: –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –Ω–∞ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ...",
#      "score": 0.76}
# ]

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤–æ–∏—Ö –∑–Ω–∞–Ω–∏–π
rag.add_analysis(
    "–ê–Ω–∞–ª–∏–∑ Q4 2025: –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–∫—Ç–æ—Ä –æ—Ç—Ç–æ–∫–∞ –≤ –¥–µ–∫–∞–±—Ä–µ ‚Äî –ø–ª–æ—Ö–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–¥–¥–µ—Ä–∂–∫–∏",
    metadata={"quarter": "Q4_2025", "industry": "telecom"}
)
```

**–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –≤–∫–ª—é—á–∞–µ—Ç:**
- –î–æ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –æ–± –æ—Ç—Ç–æ–∫–µ (—Ç–µ–ª–µ–∫–æ–º, SaaS, –±–∞–Ω–∫–∏, e-commerce)
- –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è (–ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–µ vs —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–µ)
- Best practices –∏–∑ –∏–Ω–¥—É—Å—Ç—Ä–∏–∏
- –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –∞–Ω–∞–ª–∏–∑—ã (–¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** `intfloat/multilingual-e5-large` ‚Äî state-of-the-art –º–Ω–æ–≥–æ—è–∑—ã—á–Ω–∞—è –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ (1024-dim vectors).

---

### 4Ô∏è‚É£ MCP Server –¥–ª—è Claude Desktop

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
python mcp_server.py
```

–î–æ–±–∞–≤—å—Ç–µ –≤ `claude_desktop_config.json`:
```json
{
  "mcpServers": {
    "churn-analyzer": {
      "command": "python",
      "args": ["/path/to/mcp_server.py"],
      "env": {
        "ANTHROPIC_API_KEY": "sk-ant-..."
      }
    }
  }
}
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –≤ **Claude Desktop** –ø–æ—è–≤—è—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

| –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `analyze_churn_dataset` | –û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ –ª—é–±–æ–º CSV, –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –æ—Ç—á—ë—Ç |
| `score_customers` | –°–∫–æ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏ –æ—Ç—Ç–æ–∫–∞ |
| `get_retention_strategy` | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —É–¥–µ—Ä–∂–∞–Ω–∏—è –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–∞ |
| `search_knowledge_base` | –ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π –æ–± –æ—Ç—Ç–æ–∫–µ |
| `explain_customer_churn` | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ |
| `get_model_status` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ–¥–µ–ª–∏ |

**–ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞ —Å Claude Desktop:**
```
User: –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –æ—Ç—Ç–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞ /Users/data/customers.csv

Claude: [–∏—Å–ø–æ–ª—å–∑—É–µ—Ç analyze_churn_dataset]
        –û–±—É—á–∏–ª –º–æ–¥–µ–ª—å –Ω–∞ 7,043 –∫–ª–∏–µ–Ω—Ç–∞—Ö. ROC-AUC: 0.91, —Ç–æ—á–Ω–æ—Å—Ç—å 85%.
        
        –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏:
        ‚Ä¢ –ü–æ–º–µ—Å—è—á–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã ‚Üí 42.7% –æ—Ç—Ç–æ–∫–∞ (–≤ 3.2 —Ä–∞–∑–∞ –≤—ã—à–µ –Ω–æ—Ä–º—ã)
        ‚Ä¢ Fiber optic ‚Üí 41.9% –æ—Ç—Ç–æ–∫–∞ (–ø—Ä–æ–±–ª–µ–º—ã —Å —Ü–µ–Ω–æ–π/–∫–∞—á–µ—Å—Ç–≤–æ–º)
        ‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏ ‚Üí +61% –∫ —Ä–∏—Å–∫—É
        
        –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
        1. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –Ω–∞ –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã
        2. –ü–µ—Ä–µ—Å–º–æ—Ç—Ä —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –Ω–∞ Fiber optic
        3. –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
```

---

### 5Ô∏è‚É£ FastAPI REST Backend

```bash
# –ó–∞–ø—É—Å–∫
uvicorn api:app --reload --port 8000
# –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://localhost:8000/docs
```

**9 —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:**

```bash
# –û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å
curl -X POST http://localhost:8000/train \
  -H "Content-Type: application/json" \
  -d '{
    "csv_path": "customers.csv",
    "use_llm_analysis": true
  }'

# –°–∫–æ—Ä–∏–Ω–≥ –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
curl -X POST http://localhost:8000/score/single \
  -d '{
    "customer": {
      "tenure": 3,
      "Contract": "Month-to-month",
      "MonthlyCharges": 75,
      "InternetService": "Fiber optic"
    },
    "explain": true
  }'
# Response:
# {
#   "churn_probability": 64.2,
#   "risk_level": "üî¥ HIGH",
#   "explanation": "–ö–ª–∏–µ–Ω—Ç –≤ –∑–æ–Ω–µ —Ä–∏—Å–∫–∞ –∏–∑-–∑–∞ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ tenure (3 –º–µ—Å) –∏..."
# }

# –ß–∞—Ç —Å –∞–≥–µ–Ω—Ç–æ–º
curl -X POST http://localhost:8000/chat \
  -d '{"message": "–ö–∞–∫–∏–µ –∫–ª–∏–µ–Ω—Ç—ã —É—Ö–æ–¥—è—Ç —á–∞—â–µ –≤—Å–µ–≥–æ?"}'

# –°—Ç—Ä–∞—Ç–µ–≥–∏—è —É–¥–µ—Ä–∂–∞–Ω–∏—è
curl -X POST http://localhost:8000/retention-strategy \
  -d '{"segment_description": "–ö–ª–∏–µ–Ω—Ç—ã —Å Fiber optic –∏ –ø–æ–º–µ—Å—è—á–Ω—ã–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º"}'
```

---

##  –†–µ–∑—É–ª—å—Ç–∞—Ç—ã (Telco Dataset)

### –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –ó–Ω–∞—á–µ–Ω–∏–µ |
|-----------|----------|
| –í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ | 7,043 |
| –£—à–ª–æ –∫–ª–∏–µ–Ω—Ç–æ–≤ | 1,869 |
| **–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç—Ç–æ–∫–∞** | **26.5%** |
| –°—Ä–µ–¥–Ω–∏–π tenure | 32.4 –º–µ—Å—è—Ü–µ–≤ |
| –°—Ä–µ–¥–Ω–∏–π –ø–ª–∞—Ç—ë–∂ | $64.76/–º–µ—Å |

### –ö–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | Random Forest | Gradient Boosting |
|---------|--------------|-------------------|
| **Accuracy** | **85%** | 83% |
| **ROC-AUC** | **0.91** | 0.89 |
| Precision | 65% | 68% |
| Recall | 78% | 73% |
| F1 Score | 70% | 70% |

### –¢–æ–ø-5 —Ñ–∞–∫—Ç–æ—Ä–æ–≤ –æ—Ç—Ç–æ–∫–∞

```
1. Tenure (–≤—Ä–µ–º—è —Å –∫–æ–º–ø–∞–Ω–∏–µ–π)       ‚Üí 0.242 importance
2. MonthlyCharges (–ø–ª–∞—Ç—ë–∂/–º–µ—Å)      ‚Üí 0.186 importance
3. Contract (—Ç–∏–ø –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞)         ‚Üí 0.134 importance
4. InternetService (—Ç–∏–ø –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)  ‚Üí 0.092 importance
5. PaymentMethod (—Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã)    ‚Üí 0.071 importance
```

### –°–µ–≥–º–µ–Ω—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑

| –°–µ–≥–º–µ–Ω—Ç | –û—Ç—Ç–æ–∫ | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |
|---------|-------|---------------|
| **Month-to-month –∫–æ–Ω—Ç—Ä–∞–∫—Ç** | **42.7%** | –í 3.2 —Ä–∞–∑–∞ –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ |
| One year –∫–æ–Ω—Ç—Ä–∞–∫—Ç | 11.3% | –ù–æ—Ä–º–∞ |
| Two year –∫–æ–Ω—Ç—Ä–∞–∫—Ç | 2.8% | –õ–æ—è–ª—å–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã |
| **Fiber optic –∏–Ω—Ç–µ—Ä–Ω–µ—Ç** | **41.9%** | –ü—Ä–æ–±–ª–µ–º–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è |
| DSL –∏–Ω—Ç–µ—Ä–Ω–µ—Ç | 19.0% | –ù–æ—Ä–º–∞ |
| –ë–µ–∑ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏ | 41.6% | –ö—Ä–∏—Ç–∏—á–Ω–æ |
| –° —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π | 15.2% | –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–∞ –Ω–∞ 61% |

### –ì—Ä—É–ø–ø–∞ –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞

**–ü—Ä–æ—Ñ–∏–ª—å:** –ü–æ–º–µ—Å—è—á–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç + Fiber optic + –ë–µ–∑ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∏

- **–†–∞–∑–º–µ—Ä –≥—Ä—É–ø–ø—ã:** 1,796 –∫–ª–∏–µ–Ω—Ç–æ–≤ (25.5%)
- **–†–µ–∞–ª—å–Ω—ã–π –æ—Ç—Ç–æ–∫:** **57.5%**
- **–°—Ä–µ–¥–Ω–∏–π –ø–ª–∞—Ç—ë–∂:** $85.49/–º–µ—Å
- **LTV –ø–æ–¥ —É–≥—Ä–æ–∑–æ–π:** $1,836,000/–≥–æ–¥

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
1. –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –≥–æ–¥–æ–≤–æ–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç (-20% discount)
2. –ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–∞ 3 –º–µ—Å—è—Ü–∞
3. –ê—É–¥–∏—Ç –∫–∞—á–µ—Å—Ç–≤–∞ Fiber optic –≤ —Ä–µ–≥–∏–æ–Ω–µ

---

##  –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone https://github.com/romchik2323/AI_analysis_agent
cd churn-analysis-agent
pip install -r requirements.txt
```

### 1. –ü—Ä–æ—Å—Ç–æ–π ML –±–µ–∑ LLM (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ä–∞–∑—É)

```python
from churn_analyzer import UniversalChurnAnalyzer

analyzer = UniversalChurnAnalyzer()
analyzer.load_data("WA_Fn-UseC_-Telco-Customer-Churn.csv")
report = analyzer.train()

print(f"ROC-AUC: {report.roc_auc}")
print(f"–û—Ç—Ç–æ–∫: {report.churn_rate}%")
print(f"–ì—Ä—É–ø–ø–∞ —Ä–∏—Å–∫–∞: {report.high_risk_count} –∫–ª–∏–µ–Ω—Ç–æ–≤")
```

### 2. –° –ª–æ–∫–∞–ª—å–Ω—ã–º Qwen2.5 (offline)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Ollama
brew install ollama  # macOS
# –∏–ª–∏ https://ollama.ai –¥–ª—è Windows/Linux

# –°–∫–∞—á–∞—Ç—å –º–æ–¥–µ–ª—å
ollama pull qwen2.5

# –ó–∞–ø—É—Å–∫
python -c "
from churn_analyzer import UniversalChurnAnalyzer
from agent import ChurnAgent

analyzer = UniversalChurnAnalyzer()
analyzer.load_data('data.csv')
report = analyzer.train()

agent = ChurnAgent(provider='ollama')
print(agent.analyze_report(report))
"
```

### 3. –° Claude API (–ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ)

```bash
export ANTHROPIC_API_KEY="sk-ant-..."

python -c "
from agent import ChurnAgent
agent = ChurnAgent(provider='claude')
response = agent.chat('–ö–∞–∫–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —É–¥–µ—Ä–∂–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç –ª—É—á—à–µ –≤—Å–µ–≥–æ?')
print(response)
"
```

### 4. REST API —Å–µ—Ä–≤–µ—Ä

```bash
uvicorn api:app --reload --port 8000
# –û—Ç–∫—Ä–æ–π—Ç–µ: http://localhost:8000/docs
```

### 5. MCP –¥–ª—è Claude Desktop

–°–º. —Å–µ–∫—Ü–∏—é "MCP Server" –≤—ã—à–µ ‚Äî –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Å—Ç–æ –æ–±—â–∞–π—Ç–µ—Å—å —Å Claude –≤ Desktop –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

### Core Stack

```python
pandas>=2.0.0              # –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
numpy>=1.24.0              # –í—ã—á–∏—Å–ª–µ–Ω–∏—è
scikit-learn>=1.3.0        # ML –º–æ–¥–µ–ª–∏
```

### LLM & Embeddings

```python
anthropic>=0.25.0          # Claude API
requests>=2.31.0           # Ollama HTTP client
transformers>=4.40.0       # E5-large –¥–ª—è RAG
torch>=2.0.0               # PyTorch backend
sentence-transformers      # –£–¥–æ–±–Ω—ã–π API –¥–ª—è embeddings
```

### API & MCP

```python
fastapi>=0.110.0           # REST API
uvicorn[standard]>=0.29.0  # ASGI —Å–µ—Ä–≤–µ—Ä
pydantic>=2.0.0            # –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
mcp>=1.0.0                 # Model Context Protocol SDK
```

### Database (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```python
sqlalchemy>=2.0.0          # ORM –¥–ª—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
psycopg2-binary>=2.9.0     # PostgreSQL –¥—Ä–∞–π–≤–µ—Ä
```

---

##  –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
churn-analysis-agent/
‚îÇ
‚îú‚îÄ‚îÄ churn_analyzer.py       # Universal ML pipeline (–ª—é–±–æ–π CSV)
‚îú‚îÄ‚îÄ agent.py                # LLM Agent (Claude + Ollama/Qwen2.5)
‚îú‚îÄ‚îÄ rag_engine.py           # RAG –Ω–∞ E5-large embeddings
‚îú‚îÄ‚îÄ mcp_server.py           # MCP Server –¥–ª—è Claude Desktop
‚îú‚îÄ‚îÄ api.py                  # FastAPI REST Backend
‚îÇ
‚îú‚îÄ‚îÄ requirements.txt        # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ README.md              # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îî‚îÄ‚îÄ –ö–ê–ö_–ó–ê–ü–£–°–¢–ò–¢–¨.md       # –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤
‚îÇ
‚îî‚îÄ‚îÄ models/                # –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
    ‚îú‚îÄ‚îÄ churn_model.pkl    # –û–±—É—á–µ–Ω–Ω–∞—è ML-–º–æ–¥–µ–ª—å
    ‚îî‚îÄ‚îÄ rag_store.pkl      # –í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ RAG
```

---

##  –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### ML Pipeline

```python
def train(csv_path: str):
    # 1. –ó–∞–≥—Ä—É–∑–∫–∞
    df = pd.read_csv(csv_path)
    
    # 2. –ê–≤—Ç–æ–ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥
    target = auto_detect_target_column(df)  # churn, churned, label, etc.
    X, y = preprocess(df, target)
    # ‚Üí –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ ‚Üí LabelEncoder
    # ‚Üí –ü—Ä–æ–ø—É—Å–∫–∏ ‚Üí –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
    # ‚Üí ID-–∫–æ–ª–æ–Ω–∫–∏ ‚Üí —É–¥–∞–ª–µ–Ω–∏–µ
    
    # 3. Split
    X_train, X_test, y_train, y_test = train_test_split(
        X, y, test_size=0.2, stratify=y
    )
    
    # 4. –û–±—É—á–µ–Ω–∏–µ
    model = RandomForestClassifier(
        n_estimators=200,
        class_weight='balanced',  # –¥–ª—è –Ω–µ—Å–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        n_jobs=-1
    )
    model.fit(X_train, y_train)
    
    # 5. –û—Ü–µ–Ω–∫–∞
    y_pred = model.predict(X_test)
    y_proba = model.predict_proba(X_test)[:, 1]
    
    metrics = {
        'accuracy': accuracy_score(y_test, y_pred),
        'roc_auc': roc_auc_score(y_test, y_proba),
        'feature_importance': model.feature_importances_
    }
    
    return model, metrics
```

### RAG Pipeline

```python
from sentence_transformers import SentenceTransformer
import numpy as np

# 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
model = SentenceTransformer('intfloat/multilingual-e5-large')

# 2. –ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
knowledge = [
    "–ö–ª–∏–µ–Ω—Ç—ã —Å –ø–æ–º–µ—Å—è—á–Ω—ã–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ —É—Ö–æ–¥—è—Ç –≤ 3-4 —Ä–∞–∑–∞ —á–∞—â–µ...",
    "–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–Ω–∏–∂–∞–µ—Ç –æ—Ç—Ç–æ–∫ –Ω–∞ 61%...",
    # ... 10+ –ø—Ä–∞–≤–∏–ª
]
embeddings = model.encode([f"passage: {k}" for k in knowledge])

# 3. –ü–æ–∏—Å–∫
query = "–ø–æ—á–µ–º—É –∫–ª–∏–µ–Ω—Ç—ã —É—Ö–æ–¥—è—Ç —Å Fiber optic"
query_emb = model.encode(f"query: {query}")

# Cosine similarity
similarities = np.dot(embeddings, query_emb) / (
    np.linalg.norm(embeddings, axis=1) * np.linalg.norm(query_emb)
)
top_k = np.argsort(similarities)[::-1][:3]

results = [knowledge[i] for i in top_k]
# ‚Üí –ü–µ—Ä–µ–¥–∞—ë–º –≤ LLM –∫–∞–∫ –∫–æ–Ω—Ç–µ–∫—Å—Ç
```

### LLM Agent Flow

```python
def analyze_report(report):
    # 1. RAG: –Ω–∞–π—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
    context = rag.search(
        f"–æ—Ç—Ç–æ–∫ {report.churn_rate}% "
        f"—Ñ–∞–∫—Ç–æ—Ä—ã: {', '.join(report.top_factors[:3])}"
    )
    
    # 2. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞
    prompt = f"""
    –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–æ–¥–µ–ª–∏ –æ—Ç—Ç–æ–∫–∞:
    
    –î–∞–Ω–Ω—ã–µ: {format_report(report)}
    
    –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π: {context}
    
    –î–∞–π –∞–Ω–∞–ª–∏–∑: –ø—Ä–∏—á–∏–Ω—ã, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–µ–π—Å—Ç–≤–∏–π.
    """
    
    # 3. LLM –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
    if provider == "claude":
        response = anthropic_client.messages.create(
            model="claude-sonnet-4",
            messages=[{"role": "user", "content": prompt}]
        )
    elif provider == "ollama":
        response = ollama_client.chat(model="qwen2.5", messages=...)
    
    # 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ RAG –¥–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    rag.add_analysis(response, metadata={"dataset": "telco"})
    
    return response
```

##  –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π LLM –ø—Ä–æ–≤–∞–π–¥–µ—Ä

```python
# agent.py

class OpenAIProvider(LLMProvider):
    def __init__(self, api_key: str, model: str = "gpt-4"):
        import openai
        self.client = openai.OpenAI(api_key=api_key)
        self.model = model
    
    def chat(self, messages: list[dict], system: str = "") -> str:
        response = self.client.chat.completions.create(
            model=self.model,
            messages=[{"role": "system", "content": system}] + messages
        )
        return response.choices[0].message.content
```

### –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å ML

```python
# churn_analyzer.py

from xgboost import XGBClassifier

def train(self, model_name: str = "random_forest"):
    if model_name == "xgboost":
        self.model = XGBClassifier(
            n_estimators=200,
            learning_rate=0.1,
            max_depth=6
        )
    # ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
```

### –î–æ–±–∞–≤–∏—Ç—å custom –º–µ—Ç—Ä–∏–∫–∏

```python
def calculate_custom_metrics(y_true, y_pred, y_proba):
    from sklearn.metrics import fbeta_score
    
    # F2 score (recall –≤–∞–∂–Ω–µ–µ precision)
    f2 = fbeta_score(y_true, y_pred, beta=2)
    
    # Profit curve
    threshold_profits = []
    for threshold in np.linspace(0, 1, 100):
        pred = (y_proba >= threshold).astype(int)
        # –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º: —É–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ç–æ–∏—Ç $50, —É–ø—É—â–µ–Ω–Ω—ã–π –∫–ª–∏–µ–Ω—Ç —Å—Ç–æ–∏—Ç $500
        profit = (pred * y_true * 450 - pred * (1-y_true) * 50).sum()
        threshold_profits.append(profit)
    
    optimal_threshold = np.argmax(threshold_profits) / 100
    
    return {"f2": f2, "optimal_threshold": optimal_threshold}
```

---

##  –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö:** –û–ø—Ç–∏–º–∞–ª–µ–Ω –¥–ª—è –¥–∞—Ç–∞—Å–µ—Ç–æ–≤ 1,000-100,000 —Å—Ç—Ä–æ–∫. –î–ª—è –±–æ–ª—å—à–∏—Ö –Ω—É–∂–Ω–∞ batch-–æ–±—Ä–∞–±–æ—Ç–∫–∞.

2. **–¢–æ–ª—å–∫–æ —Ç–∞–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:** –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ç–µ–∫—Å—Ç–æ–º, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏, –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ä—è–¥–∞–º–∏ –Ω–∞–ø—Ä—è–º—É—é.

3. **RAG –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π:** –ü–æ–∫–∞ 10 –ø—Ä–∞–≤–∏–ª ‚Äî –¥–ª—è production –Ω—É–∂–Ω–æ 100+.

4. **LLM —Ç–æ–∫–µ–Ω—ã:** –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Claude API —É—á–∏—Ç—ã–≤–∞–π—Ç–µ —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ—Ç—á—ë—Ç–æ–≤.

5. **–û–±—ä—è—Å–Ω–∏–º–æ—Å—Ç—å:** Feature importance –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤–∞–∂–Ω—ã, –Ω–æ –Ω–µ –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –æ–Ω–∏ –≤–ª–∏—è—é—Ç (–¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–µ–Ω SHAP/LIME).

---

##  Roadmap

- [ ] SHAP values –¥–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ (LSTM –¥–ª—è sequence churn)
- [ ] Web UI (Streamlit/Gradio)
- [ ] A/B —Ç–µ—Å—Ç —Å–∏–º—É–ª—è—Ç–æ—Ä –¥–ª—è retention —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CRM —Å–∏—Å—Ç–µ–º–∞–º–∏ (Salesforce, HubSpot)
- [ ] Real-time scoring API (streaming predictions)
- [ ] Multi-tenant –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (—Ä–∞–∑–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ)





